name: Quality

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test-e2e:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Install puppeteer
        run: npm i -g puppeteer@21.1.1
      - name: Run e2e tests
        run: cd ./e2e && pnpm run test

  test-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Run backend tests
        run: cd ./apps/backend && pnpm run test

  test-collector:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Run collector tests
        run: cd ./apps/collector-proxy && pnpm run test

  graphql-schema:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Run collector tests
        run: cd ./packages/graphql-schema && pnpm run test

  opentelemetry:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Run collector tests
        run: cd ./packages/opentelemetry && pnpm run test

  time:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Run collector tests
        run: cd ./packages/time && pnpm run test

  trace-directive:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Run collector tests
        run: cd ./packages/trace-directive && pnpm run test

  trace-schema:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Run collector tests
        run: cd ./packages/trace-schema && pnpm run test

  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-project
      - name: Lint source
        run: pnpm lint
